{"version":3,"file":"/Users/mwistrand/projects/dojo/widgets/src/grid/index.ts","sourceRoot":"","sources":["../node_modules/tslint-loader/index.js??ref--4!/Users/mwistrand/projects/dojo/widgets/node_modules/@dojo/webpack-contrib/css-module-dts-loader/index.js?type=ts&instanceName=0_custom-elements!/Users/mwistrand/projects/dojo/widgets/src/grid/index.ts"],"names":[],"mappings":"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","sourcesContent":["import WidgetBase from '@dojo/framework/widget-core/WidgetBase';\nimport { v, w } from '@dojo/framework/widget-core/d';\nimport ThemedMixin, { theme, ThemedProperties } from '@dojo/framework/widget-core/mixins/Themed';\nimport customElement from '@dojo/framework/widget-core/decorators/customElement';\nimport diffProperty from '@dojo/framework/widget-core/decorators/diffProperty';\nimport { DNode } from '@dojo/framework/widget-core/interfaces';\nimport { reference } from '@dojo/framework/widget-core/diff';\nimport { Store } from '@dojo/framework/stores/Store';\nimport Dimensions from '@dojo/framework/widget-core/meta/Dimensions';\nimport Resize from '@dojo/framework/widget-core/meta/Resize';\n\nimport { Fetcher, ColumnConfig, GridState, Updater } from './interfaces';\nimport {\n\tfetcherProcess,\n\tpageChangeProcess,\n\tsortProcess,\n\tfilterProcess,\n\tupdaterProcess\n} from './processes';\n\nimport Header, { SortRenderer, FilterRenderer } from './Header';\nimport Body from './Body';\nimport Footer from './Footer';\nimport * as css from '../theme/grid.m.css';\nimport * as fixedCss from './styles/grid.m.css';\n\nconst defaultGridMeta = {\n\tpage: 1,\n\ttotal: undefined,\n\tsort: undefined,\n\tfilter: undefined,\n\tisSorting: false,\n\teditedRow: undefined\n};\n\nexport interface CustomRenderers {\n\tsortRenderer?: SortRenderer;\n\tfilterRenderer?: FilterRenderer;\n}\n\nexport interface GridProperties<S> extends ThemedProperties {\n\tcolumnConfig: ColumnConfig[];\n\tfetcher: Fetcher<S>;\n\theight: number;\n\tupdater?: Updater<S>;\n\tstore?: Store<S>;\n\tstoreId?: string;\n\tcustomRenderers?: CustomRenderers;\n}\n\n@theme(css)\n@customElement<GridProperties<any>>({\n\ttag: 'dojo-grid',\n\tproperties: ['theme', 'classes', 'height', 'fetcher', 'updater', 'columnConfig', 'store'],\n\tattributes: ['storeId']\n})\nexport default class Grid<S> extends ThemedMixin(WidgetBase)<GridProperties<S>> {\n\tprivate _store = new Store<GridState<S>>();\n\tprivate _handle: any;\n\tprivate _scrollLeft = 0;\n\tprivate _pageSize = 100;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._handle = this._store.onChange(this._store.path('_grid'), this.invalidate.bind(this));\n\t}\n\n\t@diffProperty('store', reference)\n\tprotected onStoreProperty(previous: any, current: any) {\n\t\tconst { storeId = '_grid' } = current;\n\t\tthis._handle.remove();\n\t\tthis._store = current.store;\n\t\tthis._handle = this._store.onChange(this._store.path(storeId), () => {\n\t\t\tthis.invalidate();\n\t\t});\n\t}\n\n\tprivate _getProperties() {\n\t\tconst { storeId = '_grid' } = this.properties;\n\t\treturn { ...this.properties, storeId };\n\t}\n\n\tprivate _getBodyHeight(): number {\n\t\tconst { height } = this.properties;\n\t\tconst headerHeight = this.meta(Dimensions).get('header');\n\t\tconst footerHeight = this.meta(Dimensions).get('footer');\n\t\treturn height - headerHeight.size.height - footerHeight.size.height;\n\t}\n\n\tprivate _fetcher(page: number, pageSize: number) {\n\t\tconst { storeId, fetcher } = this._getProperties();\n\t\tfetcherProcess(this._store)({ id: storeId, fetcher, page, pageSize });\n\t}\n\n\tprivate _sorter(columnId: string, direction: 'asc' | 'desc') {\n\t\tconst { storeId, fetcher } = this._getProperties();\n\t\tsortProcess(this._store)({ id: storeId, fetcher, columnId, direction });\n\t}\n\n\tprivate _filterer(columnId: string, value: any) {\n\t\tconst { storeId, fetcher } = this._getProperties();\n\t\tfilterProcess(this._store)({ id: storeId, fetcher, filterOptions: { columnId, value } });\n\t}\n\n\tprivate _updater(page: number, rowNumber: number, columnId: string, value: string) {\n\t\tconst { storeId, updater } = this._getProperties();\n\t\tupdaterProcess(this._store)({ id: storeId, page, columnId, rowNumber, value, updater });\n\t}\n\n\tprivate _pageChange(page: number) {\n\t\tconst { storeId } = this._getProperties();\n\t\tpageChangeProcess(this._store)({ id: storeId, page });\n\t}\n\n\tprivate _onScroll(value: number) {\n\t\tthis._scrollLeft = value;\n\t\tthis.invalidate();\n\t}\n\n\tprotected render(): DNode {\n\t\tconst {\n\t\t\tcolumnConfig,\n\t\t\tstoreId,\n\t\t\ttheme,\n\t\t\tclasses,\n\t\t\tcustomRenderers = {}\n\t\t} = this._getProperties();\n\t\tconst { sortRenderer, filterRenderer } = customRenderers;\n\n\t\tif (!columnConfig || !this.properties.fetcher) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst meta = this._store.get(this._store.path(storeId, 'meta')) || defaultGridMeta;\n\t\tconst pages = this._store.get(this._store.path(storeId, 'data', 'pages')) || {};\n\t\tconst hasFilters = columnConfig.some((config) => !!config.filterable);\n\t\tconst bodyHeight = this._getBodyHeight();\n\t\tthis.meta(Resize).get('root');\n\n\t\tif (bodyHeight <= 0) {\n\t\t\treturn v('div', {\n\t\t\t\tkey: 'root',\n\t\t\t\tclasses: [this.theme(css.root), fixedCss.rootFixed],\n\t\t\t\trole: 'table'\n\t\t\t});\n\t\t}\n\n\t\treturn v(\n\t\t\t'div',\n\t\t\t{\n\t\t\t\tkey: 'root',\n\t\t\t\tclasses: [this.theme(css.root), fixedCss.rootFixed],\n\t\t\t\trole: 'table',\n\t\t\t\t'aria-rowcount': meta.total ? `${meta.total}` : null\n\t\t\t},\n\t\t\t[\n\t\t\t\tv(\n\t\t\t\t\t'div',\n\t\t\t\t\t{\n\t\t\t\t\t\tkey: 'header',\n\t\t\t\t\t\tscrollLeft: this._scrollLeft,\n\t\t\t\t\t\tclasses: [\n\t\t\t\t\t\t\tthis.theme(css.header),\n\t\t\t\t\t\t\tfixedCss.headerFixed,\n\t\t\t\t\t\t\thasFilters ? this.theme(css.filterGroup) : null\n\t\t\t\t\t\t],\n\t\t\t\t\t\trow: 'rowgroup'\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\tw(Header, {\n\t\t\t\t\t\t\tkey: 'header-row',\n\t\t\t\t\t\t\ttheme,\n\t\t\t\t\t\t\tclasses,\n\t\t\t\t\t\t\tcolumnConfig,\n\t\t\t\t\t\t\tsorter: this._sorter,\n\t\t\t\t\t\t\tsort: meta.sort,\n\t\t\t\t\t\t\tfilter: meta.filter,\n\t\t\t\t\t\t\tfilterer: this._filterer,\n\t\t\t\t\t\t\tsortRenderer,\n\t\t\t\t\t\t\tfilterRenderer\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t),\n\t\t\t\tw(Body, {\n\t\t\t\t\tkey: 'body',\n\t\t\t\t\ttheme,\n\t\t\t\t\tclasses,\n\t\t\t\t\tpages,\n\t\t\t\t\ttotalRows: meta.total,\n\t\t\t\t\tpageSize: this._pageSize,\n\t\t\t\t\tcolumnConfig,\n\t\t\t\t\tfetcher: this._fetcher,\n\t\t\t\t\tpageChange: this._pageChange,\n\t\t\t\t\tupdater: this._updater,\n\t\t\t\t\tonScroll: this._onScroll,\n\t\t\t\t\theight: bodyHeight\n\t\t\t\t}),\n\t\t\t\tv('div', { key: 'footer' }, [\n\t\t\t\t\tw(Footer, {\n\t\t\t\t\t\tkey: 'footer-row',\n\t\t\t\t\t\ttheme,\n\t\t\t\t\t\tclasses,\n\t\t\t\t\t\ttotal: meta.total,\n\t\t\t\t\t\tpage: meta.page,\n\t\t\t\t\t\tpageSize: this._pageSize\n\t\t\t\t\t})\n\t\t\t\t])\n\t\t\t]\n\t\t);\n\t}\n}\n"]}